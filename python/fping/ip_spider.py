#!/usr/bin/python3
import json
import threading
import time
from datetime import datetime
from multiprocessing import Queue
from src.collector.util.utils_logger import get_logger
from src.collector.util.shell_command import exe_command
# from utils_logger import get_logger
# from shell_command import exe_command

logger = get_logger('test', "INFO")
FPING_CMD = "fping -ag {} 2>/dev/null"


class MyThread(threading.Thread):
    def __init__(self, name, task_queue, res_queue):
        threading.Thread.__init__(self)
        self.name = name
        self.task_queue = task_queue
        self.res_queue = res_queue

    def run(self):
        # logger.info("开始线程：" + self.name)
        while True:
            try:
                prefixes = self.task_queue.get(timeout=1)
            except Exception as e:
                logger.info('任务队列为空，线程任务结束')
                break
            cmd = FPING_CMD.format(prefixes)
            ip_list = exe_command(cmd, timeout=30)
            self.res_queue.put(ip_list)
            logger.info("{}-- prefixes : {}, ips : {}".format(self.name, prefixes, ip_list))
        logger.info('{}-- 完成任务，即将关闭！'.format(self.name))


def ip_spider():
    # 存放prefixes信息，理论上一个运营商的prefixes数量为500
    res_queue = Queue(10000)
    task_queue = Queue(10000)
    segment_list = ['23.62.56.0/22', '179.68.0.0/16', '179.140.0.0/15', '179.142.0.0/15', '179.237.0.0/20', '179.237.16.0/21', '179.237.24.0/23', '186.249.160.0/20', '187.28.0.0/16', '187.29.0.0/16', '187.30.0.0/16', '187.43.0.0/16', '189.2.0.0/16', '189.3.0.0/16', '189.16.0.0/16', '189.17.0.0/16', '189.22.0.0/16', '189.23.0.0/16', '189.42.0.0/16', '189.43.0.0/16', '189.52.0.0/16', '189.53.0.0/16', '189.86.0.0/16', '189.87.0.0/16', '189.88.0.0/16', '191.38.0.0/15', '200.10.159.0/24', '200.139.192.0/18', '200.166.0.0/16', '200.167.0.0/16', '200.172.0.0/16', '200.173.0.0/16', '200.174.0.0/16', '200.178.0.0/16', '200.179.0.0/16', '200.182.0.0/16', '200.183.0.0/16', '200.190.0.0/16', '200.191.0.0/16', '200.192.0.0/18', '200.208.0.0/16', '200.209.0.0/16', '200.210.0.0/16', '200.211.0.0/16', '200.212.0.0/16', '200.213.0.0/16', '200.214.0.0/16', '200.227.0.0/16', '200.228.0.0/16', '200.230.0.0/16', '200.231.0.0/16', '200.241.0.0/16', '200.242.0.0/16', '200.243.0.0/16', '200.244.0.0/16', '200.245.0.0/16', '200.246.0.0/16', '200.247.0.0/16', '200.248.0.0/16', '200.249.0.0/16', '200.250.0.0/16', '200.251.0.0/16', '200.252.0.0/16', '200.253.0.0/16', '200.254.0.0/16', '200.255.0.0/16', '201.30.0.0/16', '201.31.0.0/16', '201.38.0.0/16', '201.39.0.0/16', '201.44.0.0/16', '201.45.0.0/16', '201.56.0.0/16', '201.57.0.0/16', '201.64.0.0/16', '201.65.0.0/16', '201.72.0.0/16', '201.73.0.0/16', '201.90.0.0/16', '104.125.100.0/22', '104.125.104.0/23', '104.125.112.0/20', '104.125.128.0/20', '177.32.0.0/16', '177.33.0.0/16', '177.34.0.0/20', '177.34.16.0/21', '177.34.24.0/21', '177.34.32.0/20', '177.34.48.0/20', '177.34.64.0/20', '177.34.80.0/20', '177.34.96.0/20', '177.34.112.0/21', '177.34.128.0/20', '177.34.144.0/20', '177.34.160.0/20', '177.34.176.0/20', '177.34.192.0/19', '177.34.224.0/20', '177.34.240.0/21', '177.34.248.0/21', '177.35.0.0/20', '177.35.16.0/20', '177.35.32.0/21', '177.35.40.0/21', '177.35.48.0/21', '177.35.56.0/21', '177.35.60.0/23', '177.35.62.0/23', '177.35.80.0/21', '177.35.88.0/21', '177.35.96.0/20', '177.35.112.0/20', '177.35.128.0/19', '177.35.160.0/19', '177.35.192.0/20', '177.35.208.0/20', '177.35.224.0/21', '177.35.232.0/21', '177.35.240.0/21', '177.35.248.0/21', '177.64.0.0/18', '177.64.64.0/19', '177.64.96.0/20', '177.64.112.0/21', '177.64.128.0/19', '177.64.160.0/19', '177.64.192.0/21', '177.64.200.0/21', '177.64.208.0/21', '177.64.216.0/21', '177.64.224.0/19', '177.65.0.0/18', '177.65.96.0/20', '177.65.112.0/20', '177.65.128.0/20', '177.65.144.0/20', '177.65.160.0/19', '177.65.192.0/21', '177.65.200.0/21', '177.65.208.0/21', '177.65.216.0/21', '177.65.224.0/20', '177.65.240.0/20', '177.80.0.0/16', '177.81.0.0/16', '177.82.0.0/20', '177.82.16.0/21', '177.82.24.0/21', '177.82.32.0/21', '177.82.40.0/21', '177.82.48.0/20', '177.82.64.0/18', '177.82.128.0/21', '177.82.136.0/21', '177.82.144.0/20', '177.82.160.0/20', '177.82.176.0/20', '177.82.192.0/19', '177.82.224.0/20', '177.82.240.0/20', '177.83.0.0/19', '177.83.32.0/21', '177.83.40.0/22', '177.83.44.0/22', '177.83.48.0/20', '177.83.64.0/18', '177.83.128.0/19', '177.83.160.0/19', '177.83.192.0/20', '177.83.208.0/20', '177.83.224.0/21', '177.83.232.0/21', '177.83.240.0/21', '177.83.248.0/21', '177.100.0.0/20', '177.100.16.0/23', '177.100.20.0/22', '177.100.24.0/21', '177.100.48.0/20', '177.100.64.0/20', '177.100.80.0/21', '177.100.88.0/21', '177.100.104.0/22', '177.100.108.0/22', '177.100.112.0/21', '177.100.120.0/21', '177.100.128.0/21', '177.100.136.0/21', '177.100.144.0/21', '177.100.152.0/21', '177.100.160.0/22', '177.100.164.0/23', '177.100.168.0/21', '177.100.176.0/21', '177.100.184.0/21', '177.100.192.0/19', '177.100.224.0/21', '177.100.232.0/22', '177.100.240.0/21', '177.127.0.0/20', '177.127.16.0/21', '177.127.24.0/21', '177.127.36.0/22', '177.127.40.0/22', '177.127.48.0/20', '177.127.64.0/21', '177.127.72.0/21', '177.127.80.0/21', '177.127.88.0/21', '177.127.96.0/21', '177.127.104.0/21', '177.127.120.0/21', '177.127.128.0/20', '177.127.144.0/21', '177.127.152.0/21', '177.127.160.0/20', '177.127.176.0/21', '177.127.184.0/21', '177.127.192.0/20', '177.127.216.0/21', '177.127.224.0/20', '177.127.240.0/21', '177.127.248.0/21', '177.140.0.0/16', '177.141.0.0/16', '177.142.0.0/16', '177.143.0.0/17', '177.143.128.0/19', '177.143.136.0/23', '177.143.160.0/20', '177.143.176.0/21', '177.143.184.0/22', '177.143.192.0/21', '177.143.200.0/21', '177.143.208.0/21', '177.143.216.0/21', '177.143.224.0/21', '177.143.232.0/21', '177.143.240.0/20', '177.180.0.0/19', '177.180.64.0/19', '177.180.96.0/20', '177.180.112.0/21', '177.180.120.0/21', '177.180.128.0/19', '177.180.160.0/19', '177.180.192.0/19', '177.180.224.0/19', '177.181.0.0/19', '177.181.32.0/19', '177.181.64.0/19', '177.181.96.0/19', '177.181.128.0/19', '177.181.160.0/21', '177.181.168.0/21', '177.181.176.0/21', '177.181.184.0/21', '177.181.192.0/19', '177.181.224.0/19', '177.182.0.0/17', '177.182.128.0/19', '177.182.160.0/19', '177.182.192.0/19', '177.182.224.0/19', '177.183.0.0/19', '177.183.32.0/21', '177.183.40.0/21', '177.183.48.0/21', '177.183.56.0/21', '177.183.64.0/18', '177.183.128.0/19', '177.183.160.0/20', '177.183.176.0/20', '177.183.192.0/20', '177.183.208.0/21', '177.183.216.0/21', '177.183.224.0/21', '177.183.232.0/21', '177.183.240.0/21', '177.183.248.0/21', '177.192.0.0/16', '177.193.0.0/20', '177.193.16.0/20', '177.193.32.0/19', '177.193.64.0/19', '177.193.96.0/20', '177.193.112.0/20', '177.193.128.0/18', '177.193.192.0/19', '177.193.224.0/20', '177.193.240.0/21', '177.193.248.0/21', '177.194.0.0/17', '177.194.128.0/18', '177.194.192.0/19', '177.194.224.0/19', '177.195.0.0/20', '177.195.16.0/20', '177.195.32.0/19', '177.195.64.0/18', '177.195.128.0/18', '177.195.192.0/19', '177.195.224.0/20', '177.195.240.0/20', '177.235.0.0/16', '179.105.0.0/20', '179.105.16.0/20', '179.105.32.0/20', '179.105.48.0/20', '179.105.64.0/18', '179.105.128.0/19', '179.105.160.0/20', '179.105.176.0/20', '179.105.192.0/20', '179.105.208.0/20', '179.105.224.0/19', '179.152.0.0/17', '179.152.128.0/19', '179.152.160.0/21', '179.152.168.0/21', '179.152.176.0/21', '179.152.184.0/21', '179.152.192.0/19', '179.152.224.0/21', '179.152.232.0/21', '179.152.240.0/21', '179.152.248.0/21', '179.153.0.0/17', '179.153.128.0/18', '179.153.192.0/18', '179.154.0.0/20', '179.154.16.0/20', '179.154.32.0/21', '179.154.40.0/21', '179.154.40.0/22', '179.154.48.0/20', '179.154.64.0/19', '179.154.96.0/20', '179.154.112.0/20', '179.154.128.0/20', '179.154.144.0/21', '179.154.152.0/21', '179.154.160.0/20', '179.154.176.0/20', '179.154.192.0/19', '179.154.224.0/20', '179.154.240.0/21', '179.154.248.0/21', '179.155.0.0/19', '179.155.32.0/19', '179.155.64.0/19', '179.155.96.0/19', '179.155.128.0/19', '179.155.160.0/19', '179.155.192.0/19', '179.155.224.0/19', '179.156.0.0/18', '179.156.64.0/20', '179.156.80.0/20', '179.156.96.0/19', '179.156.128.0/19', '179.156.160.0/19', '179.156.192.0/18', '179.157.0.0/21', '179.157.8.0/21', '179.157.16.0/21', '179.157.32.0/19', '179.157.64.0/19', '179.157.96.0/19', '179.157.100.0/23', '179.157.106.0/23', '179.157.123.0/24', '179.157.128.0/18', '179.157.192.0/18', '179.157.202.0/23', '179.157.232.0/23', '179.158.0.0/16', '179.159.0.0/16', '179.208.0.0/16', '179.209.0.0/16', '179.210.0.0/16', '179.211.0.0/19', '179.211.32.0/21', '179.211.40.0/21', '179.211.44.0/22', '179.211.48.0/20', '179.211.96.0/19', '179.211.106.0/23', '179.211.128.0/19', '179.211.160.0/19', '179.211.192.0/19', '179.211.224.0/20', '179.211.240.0/21', '179.211.248.0/21', '179.212.0.0/16', '179.213.0.0/17', '179.213.128.0/17', '179.214.0.0/18', '179.214.96.0/20', '179.214.96.0/19', '179.214.112.0/20', '179.214.128.0/18', '179.214.192.0/19', '179.214.224.0/20', '179.214.240.0/20', '179.215.0.0/19', '179.215.32.0/19', '179.215.64.0/20', '179.215.80.0/20', '179.215.96.0/22', '179.215.96.0/21', '179.215.100.0/22', '179.215.104.0/22', '179.215.104.0/21', '179.215.108.0/22', '179.215.112.0/20', '179.215.128.0/18', '179.215.192.0/19', '179.215.224.0/19', '179.216.0.0/20', '179.216.16.0/20', '179.216.32.0/20', '179.216.48.0/20', '179.216.80.0/20', '179.216.96.0/20', '179.216.112.0/20', '179.216.128.0/19', '179.216.160.0/19', '179.216.192.0/19', '179.216.224.0/20', '179.216.240.0/20', '179.217.0.0/18', '179.217.64.0/19', '179.217.96.0/19', '179.217.128.0/18', '179.217.192.0/21', '179.217.200.0/21', '179.217.208.0/20', '179.217.224.0/20', '179.217.240.0/20', '179.218.0.0/16', '179.219.0.0/17', '179.219.128.0/18', '179.219.192.0/19', '179.219.224.0/19', '179.220.0.0/19', '179.220.32.0/19', '179.220.64.0/19', '179.220.96.0/19', '179.220.128.0/19', '179.220.160.0/19', '179.220.192.0/19', '179.220.224.0/19', '179.221.0.0/19', '179.221.32.0/19', '179.221.64.0/19', '179.221.96.0/20', '179.221.112.0/20', '179.221.128.0/20', '179.221.144.0/20', '179.221.160.0/20', '179.221.192.0/19', '179.221.224.0/19', '179.222.0.0/17', '179.222.128.0/19', '179.222.160.0/19', '179.222.192.0/19', '179.222.224.0/20', '179.222.240.0/20', '179.223.0.0/17', '179.223.28.0/22', '179.223.128.0/20', '179.223.144.0/21', '179.223.152.0/21', '179.223.160.0/20', '179.223.176.0/20', '179.223.192.0/19', '179.223.224.0/19', '179.232.0.0/19', '179.232.32.0/19', '179.232.64.0/19', '179.232.96.0/19', '179.232.128.0/19', '179.232.160.0/20', '179.232.176.0/21', '179.232.184.0/21', '179.232.192.0/21', '179.232.200.0/21', '179.232.208.0/20', '179.232.224.0/20', '179.232.226.0/23', '179.232.236.0/22', '179.232.240.0/20', '179.233.0.0/20', '179.233.16.0/20', '179.233.64.0/21', '179.233.72.0/21', '179.233.80.0/20', '179.233.96.0/19', '179.233.128.0/19', '179.233.160.0/19', '179.233.192.0/20', '179.233.208.0/20', '179.233.224.0/19', '179.234.0.0/19', '179.234.32.0/19', '179.234.64.0/19', '179.234.96.0/20', '179.234.112.0/20', '179.234.128.0/20', '179.234.144.0/20', '179.234.160.0/20', '179.234.176.0/20', '179.234.192.0/19', '179.234.224.0/19', '179.235.0.0/19', '179.235.32.0/19', '179.235.64.0/19', '179.235.96.0/19', '179.235.128.0/18', '179.235.192.0/19', '179.235.224.0/23', '179.235.224.0/20', '179.235.240.0/21', '179.235.248.0/21', '181.213.0.0/22', '181.213.4.0/22', '181.213.8.0/21', '181.213.16.0/20', '181.213.32.0/19', '181.213.64.0/19', '181.213.96.0/19', '181.213.128.0/18', '181.213.132.0/24', '181.213.140.0/22', '181.213.154.0/24', '181.213.155.0/24', '181.213.157.0/24', '181.213.166.0/24', '181.213.192.0/18', '181.213.240.0/20', '181.216.40.0/21', '181.216.48.0/21', '181.216.56.0/21', '181.216.64.0/21', '181.216.72.0/21', '181.216.80.0/21', '181.216.88.0/21', '181.216.96.0/21', '181.216.104.0/21', '181.216.112.0/21', '181.216.120.0/21', '181.216.128.0/21', '181.216.136.0/21', '181.216.144.0/21', '181.216.152.0/21', '181.216.160.0/21', '181.216.168.0/21', '181.216.176.0/20', '181.216.192.0/21', '181.216.200.0/21', '181.216.208.0/21', '181.216.216.0/21', '181.216.240.0/21', '181.217.0.0/21', '181.217.40.0/21', '181.217.48.0/21', '181.217.56.0/21', '181.217.64.0/21', '181.217.72.0/21', '181.217.80.0/21', '181.217.88.0/21', '181.217.96.0/21', '181.217.104.0/21', '181.217.112.0/21', '181.217.120.0/21', '181.217.128.0/21', '181.217.136.0/21', '181.217.144.0/21', '181.217.152.0/21', '181.217.160.0/21', '181.217.168.0/21', '181.217.176.0/21', '181.217.184.0/21', '181.217.192.0/21', '181.217.200.0/21', '181.217.208.0/20', '181.217.224.0/21', '181.217.232.0/21', '181.217.240.0/21', '181.217.248.0/21', '181.218.0.0/21', '181.218.8.0/21', '181.218.16.0/21', '181.218.24.0/21', '181.218.32.0/21', '181.218.40.0/21', '181.218.48.0/21', '181.218.56.0/21', '181.218.64.0/21', '181.218.72.0/21', '181.218.80.0/21', '181.218.88.0/21', '181.218.96.0/21', '181.218.120.0/21', '181.218.128.0/21', '181.218.136.0/21', '181.218.144.0/21', '181.218.152.0/21', '181.218.160.0/21', '181.218.168.0/21', '181.218.176.0/21', '181.218.184.0/21', '181.218.192.0/21', '181.218.200.0/21', '181.218.208.0/21', '181.218.216.0/21', '181.218.224.0/21', '181.218.232.0/21', '181.218.248.0/21', '181.219.0.0/21', '181.219.8.0/21', '181.219.16.0/21', '181.219.24.0/21', '181.219.40.0/21', '181.219.48.0/21', '181.219.56.0/21', '181.219.64.0/21', '181.219.72.0/21', '181.219.80.0/21', '181.219.96.0/21', '181.219.104.0/21', '181.219.112.0/21', '181.219.120.0/21', '181.219.128.0/21', '181.219.136.0/21', '181.219.144.0/21', '181.219.152.0/21', '181.219.160.0/21', '181.219.168.0/21', '181.219.176.0/21', '181.219.184.0/21', '181.219.192.0/21', '181.219.200.0/21', '181.219.208.0/21', '181.219.216.0/21', '181.219.224.0/21', '181.219.232.0/21', '181.219.240.0/21', '181.219.248.0/21', '181.220.0.0/17', '181.220.128.0/19', '181.220.160.0/19', '181.220.192.0/19', '181.220.224.0/19', '181.221.0.0/19', '181.221.32.0/19', '181.221.64.0/19', '181.221.96.0/19', '181.221.128.0/19', '181.221.160.0/19', '181.221.192.0/19', '181.221.224.0/20', '181.221.240.0/20', '181.222.0.0/19', '181.222.32.0/19', '181.222.64.0/19', '181.222.96.0/19', '181.222.128.0/19', '181.222.160.0/19', '181.222.192.0/19', '181.222.224.0/19', '181.223.0.0/18', '181.223.64.0/19', '181.223.96.0/19', '181.223.128.0/19', '181.223.160.0/20', '181.223.176.0/20', '181.223.180.0/22', '181.223.184.0/22', '181.223.190.0/23', '181.223.192.0/20', '181.223.208.0/20', '181.223.224.0/20', '181.223.240.0/21', '181.223.248.0/21', '181.223.252.0/23', '181.223.255.0/24', '186.204.0.0/16', '186.205.0.0/16', '186.206.0.0/17', '186.206.128.0/17', '186.207.0.0/18', '186.207.64.0/18', '186.207.128.0/19', '186.207.160.0/19', '186.207.192.0/20', '186.207.208.0/20', '186.207.224.0/21', '186.207.232.0/21', '186.207.240.0/20', '186.218.0.0/21', '186.218.8.0/21', '186.218.16.0/21', '186.218.24.0/22', '186.218.28.0/22', '186.218.32.0/21', '186.218.40.0/21', '186.218.48.0/21', '186.218.56.0/21', '186.218.64.0/20', '186.218.80.0/20', '186.218.96.0/21', '186.218.104.0/21', '186.218.112.0/24', '186.218.112.0/20', '186.218.113.0/24', '186.218.114.0/24', '186.218.115.0/24', '186.218.116.0/24', '186.218.117.0/24', '186.218.118.0/24', '186.218.119.0/24', '186.218.120.0/23', '186.218.128.0/21', '186.218.136.0/21', '186.218.144.0/21', '186.218.160.0/21', '186.218.168.0/21', '186.218.176.0/21', '186.218.184.0/21', '186.218.192.0/20', '186.218.196.0/22', '186.218.204.0/22', '186.218.208.0/21', '186.218.220.0/22', '186.218.224.0/22', '186.218.232.0/21', '186.218.244.0/22', '186.218.248.0/21', '186.220.0.0/16', '186.221.0.0/16', '186.222.0.0/18', '186.222.64.0/19', '186.222.112.0/22', '186.222.116.0/22', '186.222.120.0/21', '186.222.128.0/19', '186.222.160.0/21', '186.222.168.0/21', '186.222.176.0/20', '186.222.192.0/19', '186.222.224.0/20', '186.222.240.0/21', '186.222.248.0/21', '186.223.0.0/17', '186.223.128.0/19', '186.223.160.0/19', '186.223.192.0/20', '186.223.208.0/20', '186.223.224.0/21', '186.223.232.0/22', '186.223.232.0/21', '186.223.239.0/24', '186.223.240.0/22', '186.223.244.0/22', '186.223.248.0/21', '187.2.0.0/18', '187.2.64.0/21', '187.2.72.0/21', '187.2.80.0/21', '187.2.88.0/21', '187.2.96.0/19', '187.2.120.0/23', '187.2.128.0/20', '187.2.144.0/20', '187.2.160.0/19', '187.2.192.0/20', '187.2.208.0/20', '187.2.224.0/20', '187.2.240.0/20', '187.3.0.0/17', '187.3.128.0/18', '187.3.192.0/19', '187.3.224.0/19', '187.20.0.0/16', '187.21.0.0/20', '187.21.16.0/21', '187.21.24.0/21', '187.21.32.0/20', '187.21.48.0/20', '187.21.64.0/18', '187.21.128.0/17', '187.22.0.0/17', '187.22.30.0/24', '187.22.31.0/24', '187.22.50.0/23', '187.22.82.0/23', '187.22.86.0/24', '187.22.123.0/24', '187.22.124.0/24', '187.22.128.0/17', '187.23.0.0/19', '187.23.32.0/19', '187.23.64.0/21', '187.23.72.0/21', '187.23.80.0/20', '187.23.96.0/20', '187.23.112.0/20', '187.23.128.0/20', '187.23.144.0/20', '187.23.160.0/20', '187.23.176.0/21', '187.23.184.0/21', '187.23.192.0/19', '187.23.224.0/19', '187.36.0.0/21', '187.36.8.0/21', '187.36.16.0/21', '187.36.24.0/22', '187.36.30.0/23', '187.36.32.0/19', '187.36.64.0/21', '187.36.72.0/21', '187.36.80.0/21', '187.36.88.0/21', '187.36.96.0/19', '187.36.128.0/17', '187.37.0.0/16', '187.38.0.0/16', '187.39.0.0/19', '187.39.32.0/20', '187.39.48.0/21', '187.39.56.0/21', '187.39.64.0/21', '187.39.72.0/21', '187.39.80.0/21', '187.39.88.0/21', '187.39.96.0/21', '187.39.104.0/21', '187.39.112.0/21', '187.39.120.0/21', '187.39.128.0/19', '187.39.160.0/21', '187.39.168.0/21', '187.39.176.0/24', '187.39.176.0/21', '187.39.177.0/24', '187.39.184.0/21', '187.39.192.0/21', '187.39.200.0/21', '187.39.208.0/20', '187.39.224.0/20', '187.39.240.0/20', '187.64.0.0/17', '187.64.128.0/18', '187.64.192.0/19', '187.64.200.0/21', '187.65.0.0/17', '187.65.128.0/20', '187.65.144.0/20', '187.65.160.0/20', '187.65.176.0/21', '187.65.184.0/21', '187.65.192.0/18', '187.66.0.0/19', '187.66.32.0/20', '187.66.48.0/20', '187.66.64.0/20', '187.66.80.0/20', '187.66.96.0/21', '187.66.104.0/21', '187.66.112.0/20', '187.66.128.0/21', '187.66.136.0/21', '187.66.144.0/21', '187.66.152.0/21', '187.66.160.0/20', '187.66.176.0/21', '187.66.184.0/21', '187.66.192.0/21', '187.66.200.0/21', '187.66.208.0/20', '187.66.224.0/20', '187.66.240.0/21', '187.66.248.0/21', '187.67.0.0/16', '187.104.0.0/20', '187.104.16.0/20', '187.104.32.0/20', '187.104.48.0/20', '187.104.64.0/20', '187.104.96.0/20', '187.104.112.0/20', '187.104.128.0/18', '187.104.192.0/19', '187.105.0.0/20', '187.105.16.0/20', '187.105.32.0/20', '187.105.48.0/20', '187.105.64.0/20', '187.105.80.0/21', '187.105.88.0/23', '187.105.88.0/24', '187.105.89.0/24', '187.105.92.0/24', '187.105.93.0/24', '187.105.96.0/20', '187.105.112.0/20', '187.105.128.0/19', '187.105.160.0/19', '187.105.192.0/18', '187.106.0.0/20', '187.106.16.0/20', '187.106.32.0/19', '187.106.64.0/21', '187.106.72.0/21', '187.106.80.0/20', '187.106.96.0/19', '187.106.98.0/23', '187.106.114.0/23', '187.106.128.0/18', '187.106.192.0/18', '187.107.0.0/21', '187.107.8.0/22', '187.107.12.0/22', '187.107.16.0/21', '187.107.24.0/22', '187.107.28.0/22', '187.107.32.0/20', '187.107.48.0/23', '177.127.112.0/21', '187.107.50.0/23', '187.107.52.0/22', '187.107.56.0/21', '177.183.10.0/23', '179.223.12.0/23', '187.106.146.0/23', '187.36.28.0/23', '187.104.80.0/20', '179.211.64.0/20', '181.219.32.0/21', '177.34.120.0/21', '177.82.24.0/22', '177.82.28.0/22', '177.183.240.0/22', '177.183.244.0/22', '179.217.192.0/22', '179.217.196.0/22', '187.23.72.0/22', '187.23.76.0/22', '187.107.64.0/19', '187.107.96.0/21', '187.107.104.0/21', '187.107.112.0/20', '187.107.128.0/18', '187.107.192.0/21', '187.107.200.0/21', '187.107.208.0/20', '187.107.224.0/20', '187.107.240.0/20', '187.122.0.0/17', '187.122.128.0/18', '187.122.192.0/19', '187.122.224.0/19', '187.123.0.0/19', '187.123.32.0/19', '187.123.64.0/20', '187.123.80.0/20', '187.123.96.0/20', '187.123.112.0/20', '187.123.116.0/23', '187.123.128.0/19', '187.123.153.0/24', '187.123.160.0/19', '187.123.224.0/20', '187.123.240.0/21', '187.180.0.0/19', '187.180.32.0/20', '187.180.48.0/20', '187.180.64.0/18', '187.180.128.0/19', '187.180.160.0/19', '187.180.192.0/19', '187.180.224.0/19', '187.181.0.0/19', '187.181.32.0/19', '187.181.64.0/19', '187.181.96.0/19', '187.181.128.0/19', '187.181.160.0/20', '187.181.176.0/20', '187.181.192.0/19', '187.181.224.0/20', '187.181.240.0/21', '187.181.252.0/22', '187.182.0.0/16', '187.183.0.0/20', '187.183.16.0/20', '187.183.32.0/19', '187.183.64.0/19', '187.183.96.0/19', '187.183.128.0/18', '187.183.192.0/20', '187.183.208.0/20', '187.183.224.0/19', '187.255.0.0/17', '187.255.128.0/21', '187.255.128.0/22', '187.255.132.0/22', '187.255.136.0/21', '187.255.144.0/20', '187.255.160.0/20', '187.255.176.0/21', '187.255.184.0/21', '187.255.192.0/19', '187.255.224.0/19', '189.4.0.0/18', '189.4.64.0/18', '189.4.104.0/24', '189.4.105.0/24', '189.4.106.0/24', '189.4.128.0/18', '189.4.140.0/22', '189.4.192.0/19', '189.4.224.0/19', '189.5.0.0/18', '189.5.64.0/18', '189.5.128.0/18', '189.5.192.0/18', '189.6.0.0/17', '189.6.128.0/17', '189.7.0.0/21', '189.7.8.0/21', '189.7.16.0/21', '189.7.24.0/21', '189.7.32.0/21', '189.7.40.0/21', '189.7.46.0/23', '189.7.48.0/21', '189.7.56.0/21', '189.7.64.0/21', '189.7.72.0/21', '189.7.80.0/21', '189.7.88.0/21', '189.7.96.0/21', '189.7.104.0/21', '189.7.112.0/21', '189.7.120.0/21', '189.7.128.0/21', '189.7.136.0/21', '189.7.144.0/21', '189.7.152.0/21', '189.7.160.0/21', '189.7.168.0/21', '189.7.176.0/21', '177.35.64.0/20', '186.218.122.0/24', '181.216.224.0/20', '177.35.58.0/24', '177.100.236.0/22', '179.232.224.0/24', '179.232.225.0/24', '181.218.75.0/24', '181.218.76.0/24', '181.218.77.0/24', '179.214.64.0/20', '179.214.80.0/20', '186.218.123.0/24', '189.4.72.0/24', '189.4.73.0/24', '189.4.74.0/24', '189.4.110.0/24', '181.216.32.0/21', '186.218.124.0/24', '189.7.184.0/21', '189.7.192.0/21', '189.7.200.0/21']
    for segment in segment_list:
        task_queue.put(segment)
    logger.info("任务规模 : {}".format(task_queue.qsize()))
    start_time = datetime.now()
    thread_list = []
    thread_count = 50
    for c in range(thread_count):
        thread = MyThread("Thread-{}".format(c), task_queue, res_queue)
        thread_list.append(thread)
        thread.start()
        time.sleep(0.1)

    logger.info('共计开启 {} 个线程，耗时 {}s'.format(thread_count, (datetime.now() - start_time).seconds))
    for thread in thread_list:
        thread.join()

    ip_list = []
    res_count = res_queue.qsize()
    for i in range(res_count):
        res = res_queue.get()
        ip_list += res
    logger.info("共计获取 {} 个IP".format(len(ip_list)))
    logger.info(ip_list)
    logger.info("退出主线程, 总耗时 : {}s".format((datetime.now() - start_time).seconds))


if __name__ == '__main__':
    ip_spider()
