#!/usr/bin/python3

import threading
from datetime import datetime
import subprocess

exitFlag = 0


class MyThread(threading.Thread):
    def __init__(self, name, command):
        threading.Thread.__init__(self)
        self.name = name
        self.command = "mtr -c 1 -rnz {}".format(command)

    def run(self):
        print("开始线程：" + self.name)
        ret = self.subprocess_popen()
        # print("command : {}, ret : \n {}".format(self.command, ret))

    # 既可以判断执行是否成功，还可以获取执行结果
    def subprocess_popen(self):
        p = subprocess.Popen(self.command, shell=True, stdout=subprocess.PIPE)  # 执行shell语句并定义输出格式
        while p.poll() is None:  # 判断进程是否结束（Popen.poll()用于检查子进程（命令）是否已经执行结束，没结束返回None，结束后返回状态码）
            if p.wait() is not 0:  # 判断是否执行成功（Popen.wait()等待子进程结束，并返回状态码；如果设置并且在timeout指定的秒数之后进程还没有结束，将会抛出一个TimeoutExpired异常。）
                print("命令执行失败，请检查设备连接状态")
                return False
            else:
                re = p.stdout.readlines()  # 获取原始执行结果
                result = []
                for i in range(2, len(re)):  # 由于原始结果需要转换编码，所以循环转为utf8编码并且去除\n换行
                    res = re[i].decode('utf-8').strip('\r\n')
                    if "???" not in res:
                        result.append(res.strip())
                return result


# 创建新线程
start_time = datetime.now()
commands = ['36.68.140.1', '36.68.140.2', '36.68.140.3', '36.68.140.4', '36.68.140.7', '36.68.140.8', '36.68.140.10', '36.68.140.9', '36.68.140.11', '36.68.140.12', '36.68.140.13', '36.68.140.14', '36.68.140.15', '36.68.140.16', '36.68.140.17', '36.68.140.18', '36.68.140.19', '36.68.140.20', '36.68.140.21', '36.68.140.24', '36.68.140.26', '36.68.140.25', '36.68.140.27', '36.68.140.28', '36.68.140.29', '36.68.140.31', '36.68.140.32', '36.68.140.33', '36.68.140.34', '36.68.140.35', '36.68.140.36', '36.68.140.37', '36.68.140.38', '36.68.140.39', '36.68.140.40', '36.68.140.41', '36.68.140.42', '36.68.140.43', '36.68.140.47', '36.68.140.46', '36.68.140.48', '36.68.140.49', '36.68.140.50', '36.68.140.53', '36.68.140.56', '36.68.140.58', '36.68.140.60', '36.68.140.61', '36.68.140.62', '36.68.140.63', '36.68.140.64', '36.68.140.65', '36.68.140.66', '36.68.140.67', '36.68.140.68', '36.68.140.69', '36.68.140.70', '36.68.140.71', '36.68.140.72', '36.68.140.73', '36.68.140.74', '36.68.140.77', '36.68.140.76', '36.68.140.78', '36.68.140.81', '36.68.140.82', '36.68.140.83', '36.68.140.84', '36.68.140.87', '36.68.140.86', '36.68.140.89', '36.68.140.90', '36.68.140.91', '36.68.140.93', '36.68.140.95', '36.68.140.96', '36.68.140.97', '36.68.140.99', '36.68.140.98', '36.68.140.100', '36.68.140.101', '36.68.140.103', '36.68.140.104', '36.68.140.105', '36.68.140.106', '36.68.140.108', '36.68.140.107', '36.68.140.109', '36.68.140.110', '36.68.140.111', '36.68.140.112', '36.68.140.113', '36.68.140.115', '36.68.140.117', '36.68.140.118', '36.68.140.120', '36.68.140.121', '36.68.140.122', '36.68.140.123', '36.68.140.124', '36.68.140.126', '36.68.140.127', '36.68.140.128', '36.68.140.129', '36.68.140.131', '36.68.140.130', '36.68.140.132', '36.68.140.134', '36.68.140.135', '36.68.140.136', '36.68.140.137', '36.68.140.138', '36.68.140.139', '36.68.140.140', '36.68.140.141', '36.68.140.142', '36.68.140.143', '36.68.140.145', '36.68.140.146', '36.68.140.147', '36.68.140.148', '36.68.140.149', '36.68.140.151', '36.68.140.153', '36.68.140.154', '36.68.140.155', '36.68.140.156', '36.68.140.157', '36.68.140.158', '36.68.140.160', '36.68.140.162', '36.68.140.164', '36.68.140.165', '36.68.140.166', '36.68.140.167', '36.68.140.168', '36.68.140.169', '36.68.140.170', '36.68.140.171', '36.68.140.172', '36.68.140.173', '36.68.140.174', '36.68.140.175', '36.68.140.176', '36.68.140.177', '36.68.140.178', '36.68.140.179', '36.68.140.180', '36.68.140.181', '36.68.140.182', '36.68.140.183', '36.68.140.184', '36.68.140.185', '36.68.140.186', '36.68.140.187', '36.68.140.188', '36.68.140.189', '36.68.140.190', '36.68.140.191', '36.68.140.192', '36.68.140.195', '36.68.140.196', '36.68.140.197', '36.68.140.198', '36.68.140.199', '36.68.140.200', '36.68.140.202', '36.68.140.203', '36.68.140.204', '36.68.140.205', '36.68.140.206', '36.68.140.208', '36.68.140.209', '36.68.140.210', '36.68.140.212', '36.68.140.211', '36.68.140.213', '36.68.140.214', '36.68.140.215', '36.68.140.216', '36.68.140.219', '36.68.140.220', '36.68.140.221', '36.68.140.222', '36.68.140.223', '36.68.140.225', '36.68.140.226', '36.68.140.227', '36.68.140.228', '36.68.140.229', '36.68.140.230', '36.68.140.231', '36.68.140.233', '36.68.140.234', '36.68.140.236', '36.68.140.237', '36.68.140.239', '36.68.140.238', '36.68.140.241', '36.68.140.240', '36.68.140.242', '36.68.140.246', '36.68.140.247', '36.68.140.249', '36.68.140.250', '36.68.140.251', '36.68.140.252', '36.68.140.253', '36.68.140.255', '36.68.141.0', '36.68.141.1', '36.68.141.2', '36.68.141.3', '36.68.141.5', '36.68.141.6', '36.68.141.9', '36.68.141.12', '36.68.141.13', '36.68.141.15', '36.68.141.20', '36.68.141.24', '36.68.141.23', '36.68.141.25', '36.68.141.26', '36.68.141.28', '36.68.141.29', '36.68.141.30', '36.68.141.31', '36.68.141.32', '36.68.141.33', '36.68.141.34', '36.68.141.35', '36.68.141.36', '36.68.141.38', '36.68.141.37', '36.68.141.40', '36.68.141.39', '36.68.141.41', '36.68.141.44', '36.68.141.45', '36.68.141.46', '36.68.141.47', '36.68.141.48', '36.68.141.49', '36.68.141.50', '36.68.141.51', '36.68.141.52', '36.68.141.53', '36.68.141.57', '36.68.141.58', '36.68.141.59', '36.68.141.61', '36.68.141.60', '36.68.141.62', '36.68.141.64', '36.68.141.65', '36.68.141.66', '36.68.141.68', '36.68.141.71', '36.68.141.72', '36.68.141.73', '36.68.141.74', '36.68.141.76', '36.68.141.75', '36.68.141.77', '36.68.141.80', '36.68.141.79', '36.68.141.81', '36.68.141.82', '36.68.141.83', '36.68.141.84', '36.68.141.85', '36.68.141.87', '36.68.141.88', '36.68.141.89', '36.68.141.90', '36.68.141.91', '36.68.141.93', '36.68.141.94', '36.68.141.95', '36.68.141.96', '36.68.141.97', '36.68.141.98', '36.68.141.100', '36.68.141.99', '36.68.141.101', '36.68.141.102', '36.68.141.103', '36.68.141.104', '36.68.141.105', '36.68.141.107', '36.68.141.108', '36.68.141.109', '36.68.141.110', '36.68.141.111', '36.68.141.112', '36.68.141.113', '36.68.141.114', '36.68.141.115', '36.68.141.117', '36.68.141.118', '36.68.141.119', '36.68.141.120', '36.68.141.121', '36.68.141.122', '36.68.141.123', '36.68.141.124', '36.68.141.126', '36.68.141.127', '36.68.141.128', '36.68.141.129', '36.68.141.131', '36.68.141.132', '36.68.141.133', '36.68.141.134', '36.68.141.135', '36.68.141.136', '36.68.141.137', '36.68.141.139', '36.68.141.140', '36.68.141.141', '36.68.141.142', '36.68.141.143', '36.68.141.144', '36.68.141.145', '36.68.141.146', '36.68.141.147', '36.68.141.149', '36.68.141.150', '36.68.141.152', '36.68.141.153', '36.68.141.155', '36.68.141.156', '36.68.141.158', '36.68.141.159', '36.68.141.160', '36.68.141.161', '36.68.141.162', '36.68.141.163', '36.68.141.164', '36.68.141.165', '36.68.141.166', '36.68.141.167', '36.68.141.168', '36.68.141.169', '36.68.141.171', '36.68.141.172', '36.68.141.173', '36.68.141.174', '36.68.141.175', '36.68.141.176', '36.68.141.178', '36.68.141.179', '36.68.141.180', '36.68.141.181', '36.68.141.182', '36.68.141.183', '36.68.141.185', '36.68.141.186', '36.68.141.187', '36.68.141.189', '36.68.141.190', '36.68.141.191', '36.68.141.192', '36.68.141.193', '36.68.141.194', '36.68.141.195', '36.68.141.196', '36.68.141.197', '36.68.141.198', '36.68.141.199', '36.68.141.200', '36.68.141.202', '36.68.141.203', '36.68.141.207', '36.68.141.209', '36.68.141.211', '36.68.141.212', '36.68.141.213', '36.68.141.214', '36.68.141.215', '36.68.141.216', '36.68.141.217', '36.68.141.218', '36.68.141.219', '36.68.141.221', '36.68.141.222', '36.68.141.223', '36.68.141.224', '36.68.141.226', '36.68.141.225', '36.68.141.227', '36.68.141.228', '36.68.141.229', '36.68.141.230', '36.68.141.231', '36.68.141.232', '36.68.141.233', '36.68.141.234', '36.68.141.236', '36.68.141.237', '36.68.141.238', '36.68.141.239', '36.68.141.240', '36.68.141.241', '36.68.141.242', '36.68.141.243', '36.68.141.246', '36.68.141.247', '36.68.141.248', '36.68.141.249', '36.68.141.251', '36.68.141.252', '36.68.141.253', '36.68.141.254', '36.68.141.255', '36.68.142.0', '36.68.142.1', '36.68.142.2', '36.68.142.3', '36.68.142.4', '36.68.142.5', '36.68.142.6', '36.68.142.8', '36.68.142.9', '36.68.142.10', '36.68.142.11', '36.68.142.12', '36.68.142.13', '36.68.142.14', '36.68.142.15', '36.68.142.16', '36.68.142.17', '36.68.142.19', '36.68.142.20', '36.68.142.21', '36.68.142.22', '36.68.142.23', '36.68.142.25', '36.68.142.24', '36.68.142.26', '36.68.142.27', '36.68.142.28', '36.68.142.29', '36.68.142.30', '36.68.142.31', '36.68.142.32', '36.68.142.34', '36.68.142.35', '36.68.142.36', '36.68.142.37', '36.68.142.38', '36.68.142.39', '36.68.142.40', '36.68.142.42', '36.68.142.43', '36.68.142.45', '36.68.142.46', '36.68.142.47', '36.68.142.48', '36.68.142.50', '36.68.142.51', '36.68.142.52', '36.68.142.53', '36.68.142.54', '36.68.142.55', '36.68.142.56', '36.68.142.57', '36.68.142.59', '36.68.142.60', '36.68.142.62', '36.68.142.65', '36.68.142.66', '36.68.142.67', '36.68.142.68', '36.68.142.69', '36.68.142.70', '36.68.142.71', '36.68.142.72', '36.68.142.73', '36.68.142.74', '36.68.142.75', '36.68.142.76', '36.68.142.77', '36.68.142.78', '36.68.142.79', '36.68.142.80', '36.68.142.81', '36.68.142.83', '36.68.142.84', '36.68.142.85', '36.68.142.87', '36.68.142.88', '36.68.142.89', '36.68.142.90', '36.68.142.91', '36.68.142.92', '36.68.142.93', '36.68.142.94', '36.68.142.95', '36.68.142.96', '36.68.142.98', '36.68.142.99', '36.68.142.100', '36.68.142.102', '36.68.142.103', '36.68.142.105', '36.68.142.106', '36.68.142.107', '36.68.142.108', '36.68.142.109', '36.68.142.110', '36.68.142.111', '36.68.142.112', '36.68.142.113', '36.68.142.114', '36.68.142.115', '36.68.142.116', '36.68.142.118', '36.68.142.119', '36.68.142.120', '36.68.142.121', '36.68.142.122', '36.68.142.123', '36.68.142.124', '36.68.142.125', '36.68.142.126', '36.68.142.129', '36.68.142.130', '36.68.142.131', '36.68.142.133', '36.68.142.134', '36.68.142.135', '36.68.142.136', '36.68.142.137', '36.68.142.138', '36.68.142.139', '36.68.142.140', '36.68.142.142', '36.68.142.141', '36.68.142.143', '36.68.142.144', '36.68.142.145', '36.68.142.146', '36.68.142.147', '36.68.142.148', '36.68.142.150', '36.68.142.151', '36.68.142.152', '36.68.142.153', '36.68.142.154', '36.68.142.155', '36.68.142.156', '36.68.142.159', '36.68.142.160', '36.68.142.162', '36.68.142.163', '36.68.142.166', '36.68.142.167', '36.68.142.168', '36.68.142.169', '36.68.142.172', '36.68.142.174', '36.68.142.175', '36.68.142.176', '36.68.142.180', '36.68.142.179', '36.68.142.181', '36.68.142.182', '36.68.142.184', '36.68.142.186', '36.68.142.185', '36.68.142.187', '36.68.142.188', '36.68.142.189', '36.68.142.190', '36.68.142.191', '36.68.142.193', '36.68.142.194', '36.68.142.196', '36.68.142.197', '36.68.142.198', '36.68.142.199', '36.68.142.200', '36.68.142.202', '36.68.142.201', '36.68.142.203', '36.68.142.204', '36.68.142.205', '36.68.142.206', '36.68.142.207', '36.68.142.208', '36.68.142.209', '36.68.142.210', '36.68.142.211', '36.68.142.212', '36.68.142.214', '36.68.142.215', '36.68.142.216', '36.68.142.217', '36.68.142.218', '36.68.142.219', '36.68.142.220', '36.68.142.221', '36.68.142.223', '36.68.142.222', '36.68.142.224', '36.68.142.225', '36.68.142.227', '36.68.142.228', '36.68.142.230', '36.68.142.231', '36.68.142.232', '36.68.142.233', '36.68.142.234', '36.68.142.235', '36.68.142.236', '36.68.142.237', '36.68.142.238', '36.68.142.239', '36.68.142.241', '36.68.142.243', '36.68.142.244', '36.68.142.245', '36.68.142.249', '36.68.142.250', '36.68.142.252', '36.68.142.251', '36.68.142.254', '36.68.142.255', '36.68.143.1', '36.68.143.2', '36.68.143.3', '36.68.143.4', '36.68.143.6', '36.68.143.7', '36.68.143.8', '36.68.143.9', '36.68.143.10', '36.68.143.11', '36.68.143.13', '36.68.143.14', '36.68.143.15', '36.68.143.16', '36.68.143.17', '36.68.143.19', '36.68.143.18', '36.68.143.20', '36.68.143.21', '36.68.143.22', '36.68.143.23', '36.68.143.24', '36.68.143.25', '36.68.143.26', '36.68.143.27', '36.68.143.28', '36.68.143.29', '36.68.143.30', '36.68.143.31', '36.68.143.32', '36.68.143.34', '36.68.143.33', '36.68.143.35', '36.68.143.36', '36.68.143.38', '36.68.143.39', '36.68.143.41', '36.68.143.40', '36.68.143.42', '36.68.143.43', '36.68.143.46', '36.68.143.47', '36.68.143.48', '36.68.143.49', '36.68.143.50', '36.68.143.51', '36.68.143.52', '36.68.143.53', '36.68.143.54', '36.68.143.55', '36.68.143.56', '36.68.143.57', '36.68.143.58', '36.68.143.60', '36.68.143.59', '36.68.143.61', '36.68.143.62', '36.68.143.63', '36.68.143.65', '36.68.143.66', '36.68.143.67', '36.68.143.69', '36.68.143.70', '36.68.143.71', '36.68.143.72', '36.68.143.73', '36.68.143.75', '36.68.143.74', '36.68.143.76', '36.68.143.77', '36.68.143.78', '36.68.143.79', '36.68.143.81', '36.68.143.82', '36.68.143.84', '36.68.143.85', '36.68.143.86', '36.68.143.87', '36.68.143.89', '36.68.143.90', '36.68.143.92', '36.68.143.94', '36.68.143.95', '36.68.143.97', '36.68.143.96', '36.68.143.99', '36.68.143.100', '36.68.143.101', '36.68.143.102', '36.68.143.104', '36.68.143.106', '36.68.143.107', '36.68.143.109', '36.68.143.110', '36.68.143.111', '36.68.143.112', '36.68.143.113', '36.68.143.114', '36.68.143.115', '36.68.143.116', '36.68.143.117', '36.68.143.118', '36.68.143.119', '36.68.143.120', '36.68.143.121', '36.68.143.122', '36.68.143.123', '36.68.143.124', '36.68.143.125', '36.68.143.126', '36.68.143.127', '36.68.143.128', '36.68.143.129', '36.68.143.131', '36.68.143.130', '36.68.143.133', '36.68.143.134', '36.68.143.135', '36.68.143.136', '36.68.143.137', '36.68.143.138', '36.68.143.139', '36.68.143.140', '36.68.143.141', '36.68.143.142', '36.68.143.143', '36.68.143.144', '36.68.143.145', '36.68.143.147', '36.68.143.148', '36.68.143.150', '36.68.143.151', '36.68.143.152', '36.68.143.153', '36.68.143.154', '36.68.143.155', '36.68.143.156', '36.68.143.157', '36.68.143.159', '36.68.143.160', '36.68.143.163', '36.68.143.165', '36.68.143.164', '36.68.143.166', '36.68.143.167', '36.68.143.168', '36.68.143.169', '36.68.143.171', '36.68.143.172', '36.68.143.174', '36.68.143.175', '36.68.143.177', '36.68.143.176', '36.68.143.179', '36.68.143.181', '36.68.143.180', '36.68.143.182', '36.68.143.183', '36.68.143.184', '36.68.143.185', '36.68.143.186', '36.68.143.187', '36.68.143.188', '36.68.143.190', '36.68.143.189', '36.68.143.191', '36.68.143.192', '36.68.143.193', '36.68.143.194', '36.68.143.195', '36.68.143.196', '36.68.143.197', '36.68.143.198', '36.68.143.201', '36.68.143.200', '36.68.143.202', '36.68.143.203', '36.68.143.204', '36.68.143.205', '36.68.143.206', '36.68.143.209', '36.68.143.210', '36.68.143.212', '36.68.143.213', '36.68.143.214', '36.68.143.215', '36.68.143.217', '36.68.143.218', '36.68.143.219', '36.68.143.220', '36.68.143.221', '36.68.143.222', '36.68.143.223', '36.68.143.224', '36.68.143.226', '36.68.143.227', '36.68.143.228', '36.68.143.230', '36.68.143.231', '36.68.143.232', '36.68.143.233', '36.68.143.235', '36.68.143.237', '36.68.143.236', '36.68.143.238', '36.68.143.240', '36.68.143.241', '36.68.143.242', '36.68.143.244', '36.68.143.245', '36.68.143.246', '36.68.143.247', '36.68.143.248', '36.68.143.249', '36.68.143.250', '36.68.143.251', '36.68.143.252', '36.68.143.254', '36.68.140.5', '36.68.140.23', '36.68.140.52', '36.68.140.54', '36.68.140.75', '36.68.140.194', '36.68.140.232', '36.68.140.243', '36.68.140.244', '36.68.140.245', '36.68.140.248', '36.68.140.254', '36.68.141.4', '36.68.141.19', '36.68.141.42', '36.68.141.56', '36.68.141.67', '36.68.141.69', '36.68.141.70', '36.68.142.58', '36.68.142.61', '36.68.142.104', '36.68.142.192', '36.68.142.253', '36.68.143.105', '36.68.143.239', '36.68.142.158']
thread_list = []
i = 0
for c in commands:
    i += 1
    thread = MyThread("Thread-{}".format(i), c)
    thread_list.append(thread)
    thread.start()

print('共计开启 {} 个线程，耗时 {}s'.format(i, (datetime.now() - start_time).seconds))
for thread in thread_list:
    thread.join()

print("退出主线程, 总耗时 : {}s".format((datetime.now() - start_time).seconds))
